<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å®Œæˆ</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; text-align: center; }
        .success-icon { font-size: 80px; color: #28a745; margin-bottom: 20px; }
        .btn { display: inline-block; padding: 15px 30px; color: white; text-decoration: none; border-radius: 8px; font-size: 18px; margin: 10px; cursor: pointer; border: none;}
        .btn-green { background-color: #28a745; }
        .btn-blue { background-color: #007bff; }
        .box { border: 1px solid #ddd; padding: 30px; border-radius: 10px; background: #f9f9f9; margin-bottom: 30px;}
        
        .mini-list { text-align: left; max-height: 300px; overflow-y: auto; border: 1px solid #eee; padding: 10px; margin-top: 10px;}
        .list-item { display: flex; align-items: center; padding: 5px; border-bottom: 1px solid #eee; }
        .list-item input { margin-right: 10px; }
    </style>
    <script>
        function toggleMusicAll(source) {
            checkboxes = document.getElementsByName('selected_music');
            for(var i=0, n=checkboxes.length;i<n;i++) {
                checkboxes[i].checked = source.checked;
            }
        }
    </script>
</head>
<body>
    <div class="success-icon">ğŸ‰</div>
    <h1>è½‰æ›æˆåŠŸï¼</h1>
    <p>æ‚¨çš„åŒ¯å…¥æª”æ¡ˆå·²ç¶“æº–å‚™å¥½äº†ã€‚</p>

    <div class="box">
        <h3>æ­¥é©Ÿ 1: å–å¾—åŒ¯å…¥æª”</h3>
        {% if filename %}
            <a href="/download_xml/{{ filename }}" class="btn btn-green">ğŸ“¥ ä¸‹è¼‰ {{ filename }}</a>
            <p style="color: #666; font-size: 14px; margin-top: 10px;">
                ä¸‹è¼‰å¾Œè«‹è‡³ <a href="https://myanimelist.net/import.php" target="_blank">MyAnimeList Import</a> ä¸Šå‚³ã€‚
            </p>
        {% else %}
            <p style="color: red;">æª”æ¡ˆç”Ÿæˆå¤±æ•—ã€‚</p>
        {% endif %}
    </div>

    <div class="box">
        <h3>æ­¥é©Ÿ 2: ä¸‹è¼‰ä¸»é¡Œæ›² (å¯é¸)</h3>
        <p>å‹¾é¸æ‚¨æƒ³è¦ä¸‹è¼‰æ­Œæ›²çš„å‹•ç•«ï¼š</p>
        
        <form action="/prepare_music" method="POST" target="_blank">
            <input type="hidden" name="user_id" value="{{ user_id }}">
            
            <div class="mini-list">
                <div style="padding: 5px; background: #eee; font-weight: bold;">
                    <input type="checkbox" onclick="toggleMusicAll(this)"> å…¨é¸
                </div>
                {% for item in results %}
                <div class="list-item">
                    <input type="checkbox" name="selected_music" value="{{ item.mal_id }}">
                    <span>{{ item.baha_title }}</span>
                </div>
                {% endfor %}
            </div>
            <br>
            <button type="submit" class="btn btn-blue">ğŸµ ä¸‹è¼‰é¸å–çš„ä¸»é¡Œæ›² (ZIP)</button>
        </form>
    </div>

    <a href="/" style="color: #666;">å›é¦–é </a>
</body>
</html>