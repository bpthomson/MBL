<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8"><title>準備猜歌中</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .container { width: 90%; max-width: 600px; }
        h2 { font-weight: 500; margin-bottom: 20px; text-align: center; color: #fff; }
        .progress-bg { width: 100%; height: 4px; background: #333; border-radius: 2px; overflow: hidden; margin-bottom: 20px; }
        .progress-fill { height: 100%; width: 0%; background: #ff9f0a; transition: width 0.3s; }
        .log-window { height: 250px; background: #000; border: 1px solid #333; padding: 15px; overflow-y: auto; font-size: 12px; line-height: 1.6; color: #aaa; border-radius: 6px; margin-bottom: 20px; }
        .log-line { border-bottom: 1px solid #1a1a1a; padding: 2px 0; }
    </style>
</head>
<body class="flex-center">
<div class="container">
    <h2 id="status">擷取音源清單中...</h2>
    <div class="progress-bg"><div class="progress-fill" id="fill"></div></div>
    <div class="log-window" id="log"></div>
</div>
<script>
const es = new EventSource("/stream_guess_playlist");
const log = document.getElementById('log');
const status = document.getElementById('status');

function addLog(txt) {
    const d = document.createElement('div');
    d.className = 'log-line'; d.innerText = txt;
    log.appendChild(d); log.scrollTop = log.scrollHeight;
}

es.onmessage = e => {
    const d = JSON.parse(e.data);
    if(d.error) { status.innerText="錯誤"; addLog("Error: "+d.error); es.close(); return; }
    if(d.msg) { document.getElementById('status').innerText = d.msg; addLog(d.msg); }
    if(d.progress) document.getElementById('fill').style.width = d.progress;
    if(d.done) {
        status.innerText = "即將進入遊戲...";
        es.close();
        setTimeout(() => window.location.href = "/play_game", 1000);
    }
};
</script>
</body>
</html>